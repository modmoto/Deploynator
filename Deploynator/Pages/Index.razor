@page "/"

<h1>@_handler.CurrentSelection</h1>

<h1>All Deployments</h1>
@foreach (var d in _handler.ReleaseDefinitions)
{
    <h4>@d.Name</h4>
}


<h1>Selected Deployments</h1>
@foreach (var d in _handler.SelectedReleaseDefinitions)
{
    <h4>@d.Name</h4>
}

<button @onclick="() => Do(() => _handler.MoveU())">ub</button>
<button @onclick="() => Do(() => _handler.MoveDown())">down</button>
<button @onclick="() => Do(() => _handler.Select())">select</button>
<button @onclick="() => Do(() => _handler.Deselect())">unselect</button>
<button @onclick="() => Do(() => _handler.LoadReleases(null, null))">Load Releases</button>
<button @onclick="() => Do(() => _eventBus.OnReleasesTriggered(_handler.SelectedReleaseDefinitions))">DELOY</button>

<select class="custom-select" @onchange="OnLanguegeChanged" title="Region is required ">  
    <option value="Select" selected disabled="disabled">(Choose person)</option>
    @foreach (var language in languages)
    {
        <option value="@language"> @language</option>
    }
</select>  

@inject EventBus _eventBus
@inject DeploymentHandler _handler

@code {

    private List<string> languages = new()
    {
        "en-US-SaraNeural",
        "es-MX-JorgeNeural",
        "de-CH-JanNeural",
        "de-DE-ConradNeural",
        "de-AT-JonasNeural",
        "de-AT-IngridNeural",
        "fr-FR-DeniseNeural",
        "hi-IN-MadhurNeural",
        "hi-IN-SwaraNeural",
        "mr-IN-AarohiNeural",
        "mr-IN-ManoharNeural",
        "en-IN-Heera",
        "en-IN-PriyaRUS",
        "en-IN-Ravi",
        "tr-TR-EmelNeural",
        "tr-TR-AhmetNeural",
    };

    protected override void OnInitialized()
    {
        _eventBus.ReleaseButtonTriggered += (_, _) => InvokeAsync(() => StateHasChanged());
        _eventBus.ReleaseButtonReleased += (_, _) => InvokeAsync(() => StateHasChanged());
        _eventBus.ReleaseLoaded += (_, _) => InvokeAsync(() => StateHasChanged());

        _eventBus.SelectedDeloyment += (_, _) => InvokeAsync(() => StateHasChanged());
        _eventBus.PreselectedDeloyment += (_, _) => InvokeAsync(() => StateHasChanged());
        _eventBus.DownButtonTriggered += (_, _) => InvokeAsync(() => StateHasChanged());
        _eventBus.UpButtonTriggered += (_, _) => InvokeAsync(() => StateHasChanged());
    }


    private void Do(Action action)
    {
        action.Invoke();
        StateHasChanged();
    }

    private void OnLanguegeChanged(ChangeEventArgs e) {
        var value = e.Value?.ToString();
        _eventBus.OnLanguageChanged(value);
    }
}
